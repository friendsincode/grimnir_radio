# docker-compose.override.yml.example
#
# Copy this file to docker-compose.override.yml and customize for your deployment.
# Docker Compose automatically merges override files with the base docker-compose.yml.
#
# IMPORTANT: Ports are NOT defined in the base docker-compose.yml to avoid merge
# conflicts when overriding. You MUST define ports here for services to be
# accessible from the host.
#
# The docker-quick-start.sh script generates this file automatically with
# your chosen port configuration.

services:
  # =============================================================================
  # REQUIRED: Define ports for all services you need to access
  # =============================================================================
  grimnir:
    ports:
      - "8080:8080"  # HTTP API - change first number to avoid conflicts
      - "9000:9000"  # Prometheus metrics

  postgres:
    ports:
      - "5432:5432"  # PostgreSQL - omit if using external DB

  redis:
    ports:
      - "6379:6379"  # Redis - omit if using external Redis

  mediaengine:
    ports:
      - "9091:9091"  # gRPC

  icecast:
    ports:
      - "8000:8000"  # Icecast streaming

  # =============================================================================
  # EXAMPLE: Change HTTP API port from 8080 to 3000
  # =============================================================================
  # grimnir:
  #   ports:
  #     - "3000:8080"

  # =============================================================================
  # EXAMPLE: Mount local media directory for development
  # =============================================================================
  # grimnir:
  #   volumes:
  #     - ./my-media:/var/lib/grimnir/media
  #     - ./my-config:/etc/grimnir

  # =============================================================================
  # EXAMPLE: Enable debug logging for development
  # =============================================================================
  # grimnir:
  #   environment:
  #     LOG_LEVEL: debug
  #     GRIMNIR_ENVIRONMENT: development
  #
  # mediaengine:
  #   environment:
  #     MEDIAENGINE_LOG_LEVEL: debug

  # =============================================================================
  # EXAMPLE: Use external PostgreSQL database
  # =============================================================================
  # grimnir:
  #   environment:
  #     GRIMNIR_DB_DSN: "host=my-external-db.example.com port=5432 user=grimnir password=secret dbname=grimnir sslmode=require"
  #   depends_on:
  #     # Remove postgres dependency if using external DB
  #     redis:
  #       condition: service_healthy
  #     mediaengine:
  #       condition: service_healthy

  # =============================================================================
  # EXAMPLE: Disable postgres service if using external database
  # =============================================================================
  # postgres:
  #   profiles:
  #     - disabled

  # =============================================================================
  # EXAMPLE: Change Icecast port from 8000 to 8080
  # =============================================================================
  # icecast:
  #   ports:
  #     - "8080:8000"

  # =============================================================================
  # EXAMPLE: Add custom Icecast configuration file
  # =============================================================================
  # icecast:
  #   volumes:
  #     - ./icecast.xml:/etc/icecast2/icecast.xml:ro

  # =============================================================================
  # EXAMPLE: Run multiple Grimnir instances with leader election
  # =============================================================================
  # grimnir-2:
  #   extends:
  #     service: grimnir
  #   container_name: grimnir-radio-2
  #   environment:
  #     GRIMNIR_INSTANCE_ID: grimnir-2
  #     LEADER_ELECTION_ENABLED: "true"
  #   ports:
  #     - "8081:8080"
  #     - "9001:9000"
  #
  # grimnir-3:
  #   extends:
  #     service: grimnir
  #   container_name: grimnir-radio-3
  #   environment:
  #     GRIMNIR_INSTANCE_ID: grimnir-3
  #     LEADER_ELECTION_ENABLED: "true"
  #   ports:
  #     - "8082:8080"
  #     - "9002:9000"

  # =============================================================================
  # EXAMPLE: Add Jaeger for distributed tracing
  # =============================================================================
  # jaeger:
  #   image: jaegertracing/all-in-one:latest
  #   container_name: grimnir-jaeger
  #   ports:
  #     - "16686:16686"  # Jaeger UI
  #     - "4317:4317"    # OTLP gRPC receiver
  #     - "4318:4318"    # OTLP HTTP receiver
  #   environment:
  #     COLLECTOR_OTLP_ENABLED: "true"
  #   networks:
  #     - grimnir-network
  #
  # # Enable tracing in Grimnir
  # grimnir:
  #   environment:
  #     TRACING_ENABLED: "true"
  #     OTLP_ENDPOINT: "jaeger:4317"
  #     TRACING_SAMPLE_RATE: "1.0"

  # =============================================================================
  # EXAMPLE: Add Prometheus for metrics collection
  # =============================================================================
  # prometheus:
  #   image: prom/prometheus:latest
  #   container_name: grimnir-prometheus
  #   ports:
  #     - "9090:9090"
  #   volumes:
  #     - ./deploy/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro
  #     - ./deploy/prometheus/alerts.yml:/etc/prometheus/alerts.yml:ro
  #     - prometheus-data:/prometheus
  #   command:
  #     - '--config.file=/etc/prometheus/prometheus.yml'
  #     - '--storage.tsdb.path=/prometheus'
  #     - '--web.console.libraries=/usr/share/prometheus/console_libraries'
  #     - '--web.console.templates=/usr/share/prometheus/consoles'
  #   networks:
  #     - grimnir-network
  #
  # # Add Grafana for visualization
  # grafana:
  #   image: grafana/grafana:latest
  #   container_name: grimnir-grafana
  #   ports:
  #     - "3001:3000"
  #   environment:
  #     GF_SECURITY_ADMIN_PASSWORD: admin
  #     GF_INSTALL_PLUGINS: grafana-clock-panel
  #   volumes:
  #     - grafana-data:/var/lib/grafana
  #     - ./deploy/grafana/dashboards:/etc/grafana/provisioning/dashboards:ro
  #     - ./deploy/grafana/datasources:/etc/grafana/provisioning/datasources:ro
  #   networks:
  #     - grimnir-network
  #   depends_on:
  #     - prometheus

  # =============================================================================
  # EXAMPLE: Add nginx reverse proxy
  # =============================================================================
  # nginx:
  #   image: nginx:alpine
  #   container_name: grimnir-nginx
  #   ports:
  #     - "80:80"
  #     - "443:443"
  #   volumes:
  #     - ./nginx.conf:/etc/nginx/nginx.conf:ro
  #     - ./ssl:/etc/nginx/ssl:ro
  #   networks:
  #     - grimnir-network
  #   depends_on:
  #     - grimnir
  #     - icecast

# =============================================================================
# EXAMPLE: Add custom volumes
# =============================================================================
# volumes:
#   prometheus-data:
#     driver: local
#   grafana-data:
#     driver: local

# =============================================================================
# EXAMPLE: Add custom networks
# =============================================================================
# networks:
#   monitoring:
#     driver: bridge
