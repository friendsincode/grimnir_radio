{{define "partials/smartblock-preview"}}
{{$tracks := index . "Tracks"}}
{{$totalMs := index . "TotalDurationMs"}}
{{$targetMin := index . "TargetMinutes"}}
{{$loopEnabled := index . "LoopEnabled"}}
{{$targetMs := mul $targetMin 60000}}
{{$diffMs := sub $totalMs $targetMs}}
<div class="p-2">
    {{if $tracks}}
    <div class="d-flex justify-content-between align-items-center mb-2 px-2">
        <span class="text-body-secondary small">
            <i class="bi bi-music-note-list me-1"></i>
            {{len $tracks}} tracks
            {{if $loopEnabled}}<i class="bi bi-repeat ms-1 text-info" title="Looped"></i>{{end}}
        </span>
        <span class="small">
            {{if $totalMs}}
            <span class="badge {{if ge $totalMs $targetMs}}bg-success{{else}}bg-warning text-dark{{end}}">
                <i class="bi bi-clock me-1"></i>
                {{formatMs $totalMs}} / {{formatMs $targetMs}}
            </span>
            {{if ne $diffMs 0}}
            <span class="badge {{if ge $diffMs 0}}bg-success{{else}}bg-danger{{end}} ms-1">
                {{if ge $diffMs 0}}+{{end}}{{if lt $diffMs 0}}-{{end}}{{formatMs $diffMs}}
            </span>
            {{end}}
            {{end}}
        </span>
    </div>
    {{end}}
    <div class="list-group list-group-flush small" style="max-height: 380px; overflow-y: auto;">
        {{range $i, $m := $tracks}}
        <div class="list-group-item px-2 py-1 d-flex align-items-center gap-2 border-0 border-bottom">
            <span class="badge bg-body-secondary text-body-secondary" style="width: 24px;">{{add $i 1}}</span>
            <div class="flex-grow-1 text-truncate">
                <div class="fw-medium text-truncate">{{$m.Title}}</div>
                {{if $m.Artist}}<div class="text-body-secondary small text-truncate">{{$m.Artist}}</div>{{end}}
            </div>
            <span class="text-body-secondary text-nowrap">{{formatDuration $m.Duration}}</span>
        </div>
        {{else}}
        <div class="text-center py-4 text-body-secondary">
            <i class="bi bi-inbox fs-3 d-block mb-2 opacity-50"></i>
            <div>No tracks matched your criteria</div>
            <small>Try adjusting your filters</small>
        </div>
        {{end}}
    </div>
</div>
{{end}}
