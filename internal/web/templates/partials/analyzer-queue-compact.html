{{define "partials/analyzer-queue-compact"}}
{{/* Compact, stable-size snippet intended for dashboard stat card */}}
{{ $active := or (gt .Pending 0) (gt .Running 0) }}
<div class="d-flex justify-content-between align-items-start">
    <div>
        <p class="text-body-secondary mb-1">Analyzer Queue</p>
        <h3 class="mb-0">
            {{if $active}}
                {{.ActiveCount}}
            {{else}}
                0
            {{end}}
        </h3>
    </div>
    <div class="bg-warning bg-opacity-10 rounded-3 p-3">
        <i class="bi bi-cpu text-warning fs-4"></i>
    </div>
</div>

<div class="mt-2 small text-body-secondary">
    {{if $active}}
        Pending {{.Pending}}, running {{.Running}}.
    {{else}}
        Idle.
    {{end}}
    <span class="ms-2">Updated {{.UpdatedAt.Format "15:04:05"}} UTC</span>
</div>

<div class="mt-2 small">
    {{if .LastComplete.MediaID}}
    <div class="text-success">
        Last OK: {{if .LastComplete.Artist}}{{.LastComplete.Artist}} - {{end}}{{if .LastComplete.Title}}{{.LastComplete.Title}}{{else}}{{.LastComplete.MediaID}}{{end}}
        <span class="text-body-secondary">({{.LastComplete.UpdatedAt.Format "2006-01-02 15:04:05"}})</span>
    </div>
    {{end}}
    {{if .LastFailed.MediaID}}
    <div class="text-danger">
        Last Failed: {{if .LastFailed.Artist}}{{.LastFailed.Artist}} - {{end}}{{if .LastFailed.Title}}{{.LastFailed.Title}}{{else}}{{.LastFailed.MediaID}}{{end}}
        <span class="text-body-secondary">({{.LastFailed.UpdatedAt.Format "2006-01-02 15:04:05"}})</span>
    </div>
    {{end}}
</div>
{{end}}
