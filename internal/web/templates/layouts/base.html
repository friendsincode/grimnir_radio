{{define "layouts/base"}}
<!DOCTYPE html>
<html lang="en" data-bs-theme="{{.Theme}}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - Grimnir Radio</title>

    <!-- Bootstrap CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="/static/css/bootstrap-icons.min.css" rel="stylesheet">

    <!-- Theme CSS -->
    <link href="/static/css/themes/{{.Theme}}.css" rel="stylesheet">
    <link href="/static/css/app.css" rel="stylesheet">

    {{block "head" .}}{{end}}
</head>
<body class="{{block "bodyClass" .}}{{end}}">
    <div id="page-content">
    {{block "content" .}}{{end}}
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="/static/js/bootstrap.bundle.min.js"></script>

    <!-- HTMX -->
    <script src="/static/js/htmx.min.js"></script>

    <!-- Alpine.js for small interactions -->
    <script defer src="/static/js/alpine.min.js"></script>

    <!-- WebRTC ICE Server Config -->
    <script>
    window.GRIMNIR_WEBRTC = {
        stunUrl: "{{.WebRTCSTUNURL}}",
        turnUrl: "{{.WebRTCTURNURL}}",
        turnUsername: "{{.WebRTCTURNUsername}}",
        turnPassword: "{{.WebRTCTURNPassword}}"
    };
    </script>

    <!-- App JS -->
    <script src="/static/js/app.js"></script>

    {{block "scripts" .}}{{end}}

    <!-- Global Audio Player - Floating & Draggable -->
    <div id="globalPlayer" class="global-player" style="display: none;">
        <!-- Drag Handle Header -->
        <div class="global-player-header" id="playerDragHandle">
            <span class="drag-handle"><i class="bi bi-grip-horizontal"></i> Drag to move</span>
            <div class="d-flex gap-1">
                <!-- Station Selector -->
                <div class="dropdown" id="playerStationSelector" style="display: none;">
                    <button class="btn btn-sm btn-link text-body p-1 dropdown-toggle" type="button" data-bs-toggle="dropdown" title="Switch Station">
                        <i class="bi bi-broadcast"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" id="playerStationMenu">
                        <li><span class="dropdown-item-text text-body-secondary small">Loading stations...</span></li>
                    </ul>
                </div>
                <button class="btn btn-sm btn-link text-body p-1" id="playerMinimize" title="Minimize">
                    <i class="bi bi-dash-lg"></i>
                </button>
                <button class="btn btn-sm btn-link text-body p-1" id="playerClose" title="Close">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
        </div>
        <div class="global-player-body">
            <!-- Progress Bar -->
            <div class="global-player-progress" id="globalPlayerProgress">
                <div class="global-player-progress-bar" id="globalPlayerProgressBar"></div>
            </div>
            <!-- Player Content -->
            <div class="d-flex align-items-center gap-3">
                <!-- Artwork -->
                <div id="playerArtwork" class="player-artwork">
                    <i class="bi bi-music-note-beamed"></i>
                </div>
                <!-- Track Info -->
                <div class="player-info flex-grow-1 text-truncate">
                    <div id="playerTitle" class="fw-semibold text-truncate">-</div>
                    <div id="playerArtist" class="small text-body-secondary text-truncate">-</div>
                </div>
                <!-- Controls -->
                <div class="d-flex align-items-center gap-1">
                    <button class="btn btn-sm btn-link text-body" id="playerPrev" title="Previous" style="visibility: hidden;">
                        <i class="bi bi-skip-start-fill fs-5"></i>
                    </button>
                    <button class="btn btn-light rounded-circle d-flex align-items-center justify-content-center"
                            id="playerPlayPause" style="width: 42px; height: 42px;" title="Play/Pause">
                        <i class="bi bi-play-fill fs-4" id="playerPlayIcon"></i>
                    </button>
                    <button class="btn btn-sm btn-link text-body" id="playerNext" title="Next" style="visibility: hidden;">
                        <i class="bi bi-skip-end-fill fs-5"></i>
                    </button>
                </div>
            </div>
            <!-- Volume (collapsible) -->
            <div class="d-flex align-items-center gap-2 mt-2 pt-2 border-top">
                <span class="small text-body-secondary">
                    <span id="playerCurrentTime">0:00</span> / <span id="playerDuration">LIVE</span>
                </span>
                <div class="flex-grow-1"></div>
                <i class="bi bi-volume-up small"></i>
                <input type="range" class="form-range" id="playerVolume" min="0" max="100" value="80" style="width: 80px;">
            </div>
        </div>
    </div>

    <!-- Toast container for notifications -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer">
        {{if .Flash}}
        <div class="toast show" role="alert" data-bs-autohide="true" data-bs-delay="5000">
            <div class="toast-header bg-{{.Flash.Type}}">
                <strong class="me-auto">
                    {{if eq .Flash.Type "success"}}<i class="bi bi-check-circle me-1"></i>{{end}}
                    {{if eq .Flash.Type "error"}}<i class="bi bi-exclamation-circle me-1"></i>{{end}}
                    {{if eq .Flash.Type "warning"}}<i class="bi bi-exclamation-triangle me-1"></i>{{end}}
                    {{if eq .Flash.Type "info"}}<i class="bi bi-info-circle me-1"></i>{{end}}
                    Notification
                </strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" title="Dismiss"></button>
            </div>
            <div class="toast-body">{{.Flash.Message}}</div>
        </div>
        {{end}}
    </div>
</body>
</html>
{{end}}
